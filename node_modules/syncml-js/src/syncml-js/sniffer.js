// -*- coding: utf-8 -*-
//-----------------------------------------------------------------------------
// file: $Id$
// auth: metagriffin <metagriffin@uberdev.org>
// date: 2013/06/25
// copy: (C) CopyLoose 2013 UberDev <hardcore@uberdev.org>, No Rights Reserved.
//-----------------------------------------------------------------------------

// for node compatibility...
if ( typeof(define) !== 'function')
  var define = require('amdefine')(module);

define([
  'underscore',
  'elementtree',
  './logging',
  './common',
  './constant'
], function(
  _,
  ET,
  logging,
  common,
  constant
) {

  var log = logging.getLogger('syncml-js.sniffer');
  var exports = {};

  //---------------------------------------------------------------------------
  exports.FileStorage = common.Base.extend({

    // stores sniffer results into a file with the following format:
    //   TIMESTAMP, DIRECTION, METHODORSTATUS, REMOTEHOSTPORT, HEADERSJSON, BODY

    //-------------------------------------------------------------------------
    constructor: function(options) {
      this.filename = options.filename;
    },

    //-------------------------------------------------------------------------
    outbound: function(session, request) {
      this._store([
        'request', request.method, request.url,
        JSON.stringify(request.headers),
        request.body
      ]);
    },

    //-------------------------------------------------------------------------
    inbound: function(session, response) {
      this._store([
        'response', request.method, request.url,
        JSON.stringify(request.headers),
        request.body
      ]);
    }

  });

  return exports;

});

//-----------------------------------------------------------------------------
// end of $Id$
//-----------------------------------------------------------------------------

